<fs-list [config]="listConfig" #list>
  <fs-list-column>
    <ng-template fs-list-cell let-conversation="row" class="col-converstaion">
      <div 
          class="converstaion-row" 
          [ngClass]="{ selected: selectedConversation?.id === conversation.id }" [attr.data]="'converstaion-row-' + conversation.id"
          (click)="openConversation(conversation)">
        <div class="converstaion">
          <ng-container *ngIf="conversationsConversationTemplate">
            <ng-container [ngTemplateOutlet]="conversationsConversationTemplate" [ngTemplateOutletContext]="{ conversation: conversation, template: conversationTemplate }"></ng-container>
          </ng-container>
          <ng-container *ngIf="!conversationsConversationTemplate">
            <ng-container [ngTemplateOutlet]="conversationTemplate" [ngTemplateOutletContext]="{ conversation: conversation }"></ng-container>
          </ng-container>
        </div>
        <div
          *ngIf="!!conversation.unread"
          class="unread"
          [ngClass]="{ 'has-unread': !!conversation.unread }"
          matTooltip="Unread">
        </div>
      </div>
    </ng-template>
  </fs-list-column>
  <ng-container fs-list-content>
    <mat-tab-group
        fsTabs
        [mobileSticky]="false"
        [selected]="tab"
        (selectedChange)="tabChange($event)">
      <mat-tab name="account">
        <ng-template mat-tab-label>
          Inbox 
          <ng-container *ngIf="conversationsStats.account.unread">
            <span class="unread has-unread"></span>
          </ng-container>
        </ng-template>
      </mat-tab>
      <mat-tab name="open">
        <ng-template mat-tab-label>
          Open
          <ng-container *ngIf="conversationsStats.open.count">
            ({{conversationsStats.open.count}})
          </ng-container>
          <ng-container *ngIf="conversationsStats.open.unread">
            <span class="unread has-unread"></span>
          </ng-container>
        </ng-template>
      </mat-tab>
      <mat-tab name="closed">
        <ng-template mat-tab-label>
          Closed
          <ng-container *ngIf="conversationsStats.closed.count">
            ({{conversationsStats.closed.count}})
          </ng-container>
          <ng-container *ngIf="conversationsStats.closed.unread">
            <span class="unread has-unread"></span>
          </ng-container>
        </ng-template>            
      </mat-tab>
    </mat-tab-group>
  </ng-container>
</fs-list>

<ng-template #conversationTemplate let-conversation="conversation">
  <div 
        class="conversation-participant"
        [ngClass]="{ 'conversation-participant-multiple': conversation.recentConversationParticipants.length > 1 }">
    <ng-container *ngIf="conversation.recentConversationParticipants.length > 1">
      <ng-container 
        [ngTemplateOutlet]="participantsMutiple" 
        [ngTemplateOutletContext]="{ 
          accountTop: conversation.recentConversationParticipants[0],
          accountBottom: conversation.recentConversationParticipants[1],
          conversationParticipantCount: conversation.conversationParticipantCount
        }">
      </ng-container>
      <ng-template 
          #participantsMutiple 
          let-accountTop="accountTop" 
          let-accountBottom="accountBottom"
          let-conversationParticipantCount="conversationParticipantCount">
        <div [matTooltip]="conversationParticipantCount | conversationBadgeName:accountTop:accountBottom">
          <app-conversation-participant 
            class="top"
            [showBadge]="true"
            [size]="30"
            [conversationParticipant]="accountTop">
          </app-conversation-participant> 
          <app-conversation-participant 
            class="bottom"
            [showBadge]="true"
            [size]="30"
            [conversationParticipant]="accountBottom">
          </app-conversation-participant> 
        </div>
      </ng-template>
    </ng-container>
    <ng-container *ngIf="conversation.recentConversationParticipants.length === 1">
      <app-conversation-participant 
        [showBadge]="true"
        [showTooltip]="true"
        [size]="40"
        [conversationParticipant]="conversation.recentConversationParticipants[0]">
      </app-conversation-participant>   
    </ng-container>
  </div>
  <div [ngClass]="{ 'participant-multiple-info': conversation.recentConversationParticipants.length > 1 }">
    <div class="name">
      <ng-container *ngIf="conversationsConversationNameTemplate; else conversationName">
        <ng-container [ngTemplateOutlet]="conversationsConversationNameTemplate" [ngTemplateOutletContext]="{ conversation: conversation, template: conversationName }"></ng-container>
      </ng-container>

      <ng-template #conversationName>
        <a>{{conversation | conversationName}}</a>
      </ng-template>
    </div>  
    <div class="last-conversation-item small" *ngIf="conversation.lastConversationItem">
      <div class="summary">
        <ng-container *ngIf="conversation.lastConversationItem.message; else lastFile">
          <div class="message">
            {{conversation.lastConversationItem.conversationParticipant.account.firstName}}: {{conversation.lastConversationItem.message}}
          </div>
        </ng-container>
        <ng-template #lastFile>
          <ng-container *ngIf="conversation.lastConversationItem.lastConversationItemFile">
            <div class="file">
              {{conversation.lastConversationItem.lastConversationItemFile.filename}}
            </div>
          </ng-container>
        </ng-template>
        <div class="small create-date">
          <fs-date-ago [date]="conversation.lastConversationItem.createDate"></fs-date-ago>
        </div>
      </div>
    </div>
  </div>  
</ng-template>
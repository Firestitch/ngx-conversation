<fs-list
  [config]="listConfig"
  [ngClass]="{ 'has-tabs': conversationService.tabs.account || conversationService.tabs.open || conversationService.tabs.closed }">
  <fs-list-column [class]="['col-converstaion']">
    <ng-template fs-list-cell let-conversation="row">
      <div
        class="converstaion-row"
        [ngClass]="{ selected: selectedConversation?.id === conversation.id }" [attr.data]="'converstaion-row-' + conversation.id"
        (click)="openConversation(conversation)">
        <div class="converstaion">
          @if (conversationsConversationTemplate) {
            <ng-container [ngTemplateOutlet]="conversationsConversationTemplate" [ngTemplateOutletContext]="{ conversation: conversation, template: conversationTemplate }"></ng-container>
          }
          @if (!conversationsConversationTemplate) {
            <ng-container [ngTemplateOutlet]="conversationTemplate" [ngTemplateOutletContext]="{ conversation: conversation }"></ng-container>
          }
        </div>
        @if (!!conversation.unread) {
          <div
            class="unread"
            [ngClass]="{ 'has-unread': !!conversation.unread }"
            matTooltip="Unread">
          </div>
        }
      </div>
    </ng-template>
  </fs-list-column>
  <ng-container fs-list-content>
    @if (conversationService.tabs.account || conversationService.tabs.open || conversationService.tabs.closed) {
      <mat-tab-group
        fsTabs
        [mobileSticky]="false"
        [selected]="tab"
        mat-stretch-tabs="false"
        (selectedChange)="tabChange($event)">
        @if (conversationService.tabs.account) {
          <mat-tab name="account">
            <ng-template mat-tab-label>
              Inbox
              @if (conversationsStats.account.unread) {
                <span class="unread has-unread"></span>
              }
            </ng-template>
          </mat-tab>
        }
        @if (conversationService.tabs.open) {
          <mat-tab name="open">
            <ng-template mat-tab-label>
              Open
              @if (conversationsStats.open.count) {
                ({{conversationsStats.open.count}})
              }
              @if (conversationsStats.open.unread) {
                <span class="unread has-unread"></span>
              }
            </ng-template>
          </mat-tab>
        }
        @if (conversationService.tabs.closed) {
          <mat-tab name="closed">
            <ng-template mat-tab-label>
              Closed
              @if (conversationsStats.closed.count) {
                ({{conversationsStats.closed.count}})
              }
              @if (conversationsStats.closed.unread) {
                <span class="unread has-unread"></span>
              }
            </ng-template>
          </mat-tab>
        }
      </mat-tab-group>
    }
  </ng-container>
</fs-list>

<ng-template #conversationTemplate let-conversation="conversation">
  <app-conversation-list-participants
    [conversation]="conversation"
    [conversationsConversationNameTemplate]="conversationsConversationNameTemplate">
  </app-conversation-list-participants>
</ng-template>

<div class="items">
  <div 
      *ngFor="let conversationItem of conversationItems; let index = index; trackBy: trackByconversationItem"
      [class]="'item item-type-' + conversationItem.type"
      [ngClass]="{ 'active-account': conversationItem.conversationParticipant?.id === sessionConversationParticipant?.id }">
    <div scrollIntoView *ngIf="index === 0"></div>
    <div class="participant" *ngIf="conversationItem.type === ConversationItemType.Message">
      <ng-container *ngIf="conversationItem.conversationParticipant?.id !== sessionConversationParticipant?.id">
        <app-conversation-participant
          [size]="30"
          [conversationParticipant]="conversationItem.conversationParticipant"
          [showBadge]="true">
        </app-conversation-participant>
        <app-conversation-participant
          class="name"
          [conversationParticipant]="conversationItem.conversationParticipant"
          [showName]="true">
        </app-conversation-participant>
      </ng-container>      
      <div class="small create-date-read">
        <fs-date-ago [date]="conversationItem.createDate"></fs-date-ago>  
        <ng-container *ngIf="conversationItem.conversationParticipantsReadCount; else read">
          <fs-popover 
            [template]="readTemplate"
            [indication]="false"
            [data]="conversationItem">
            <a (click)="openReadParticipants(conversationItem)">
              <ng-container *ngTemplateOutlet="read"></ng-container>
            </a>
          </fs-popover>
        </ng-container>

        <ng-template #read>
          <span class="read">
            <mat-icon>remove_red_eye</mat-icon> {{conversationItem.conversationParticipantsReadCount}}
          </span>
        </ng-template>
      </div>   
      <fs-menu class="item-menu" *ngIf="conversationItem.canDelete">
        <ng-template fs-menu-item (click)="conversationItemDelete(conversationItem)">
          Delete
        </ng-template>
      </fs-menu>        
    </div>
    <ng-container *ngIf="conversationItem.type === ConversationItemType.Message">
      <div class="message-container">
        <div class="content">
          <div class="content-container">
            <div class="message" *ngIf="conversationItem.message">
              <span [innerHTML]="conversationItem.message"></span>                    
            </div>

            <fs-gallery [config]="conversationItem.galleryConfig" *ngIf="conversationItem.conversationItemFiles.length">
              <ng-template fsGalleryThumbnail let-item="item">
                <button 
                    [fsMenuTriggerFor]="menu" 
                    mat-icon-button 
                    class="file-menu"
                    (click)="$event.stopPropagation()">
                  <mat-icon>more_vert</mat-icon> 
                </button>
                <fs-menu #menu>
                  <ng-template fs-menu-item (click)="fileDownload(conversationItem, item.data)">
                    Download  
                  </ng-template>
                </fs-menu>
              </ng-template>
            </fs-gallery>                   
          </div>
        </div>                    
      </div>
    </ng-container>    
    <ng-container *ngIf="conversationItem.type === ConversationItemType.ParticipantAdd || conversationItem.type === ConversationItemType.ParticipantRemoved || conversationItem.type === ConversationItemType.Start">        
      <div class="info">
        <ng-container *ngIf="conversationItem.type === ConversationItemType.ParticipantRemoved">
          {{conversationItem.conversationParticipantsRemovedCount === 1 ? '1 Participant' : conversationItem.conversationParticipantsRemovedCount + ' Participants'}}  Removed 
        </ng-container>
        <ng-container *ngIf="conversationItem.type === ConversationItemType.ParticipantAdd">
          {{conversationItem.conversationParticipantsAddedCount === 1 ? '1 Participant' : conversationItem.conversationParticipantsAddedCount + ' Participants'}}  Added  
        </ng-container>
        <ng-container *ngIf="conversationItem.type === ConversationItemType.Start">
            Conversation Started
        </ng-container>
        Â· <fs-date-ago [date]="conversationItem.createDate"></fs-date-ago> 
      </div>
    </ng-container>                 
  </div>            
</div>

<ng-template #readTemplate let-conversationItem="data">
  <app-conversation-read-participants-popover
    [conversationService]="conversationService"
    [account]="account"
    [conversationItem]="conversationItem">
  </app-conversation-read-participants-popover>
</ng-template>
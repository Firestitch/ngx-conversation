<form fsForm [submit]="save">
  <fs-dialog>
    <div mat-dialog-title>Settings</div>
    <mat-dialog-content *fsSkeletonForm="conversation">
      @if (hasAdminRole) {
        <mat-tab-group fsTabs [(selected)]="tab">
          <mat-tab label="General" name="settings">
            <ng-template matTabContent>
              @if (!conversationService.conversationSettingTemplate) {
                @if (conversationService.conversationConfig.conversationSettings.name.show) {
                  <mat-form-field class="full-width">
                    <mat-label>Name</mat-label>
                    <input
                      matInput
                      [required]="conversationService.conversationConfig.conversationSettings.name.required"
                      [(ngModel)]="conversation.name"
                      name="name">
                  </mat-form-field>
                }
                <mat-form-field class="full-width">
                  <mat-label>Status</mat-label>
                  <mat-select
                    [(ngModel)]="conversation.state"
                    name="conversation.state">
                    @for (item of ConversationStates; track item) {
                      <mat-option
                        [value]="item.value">
                        {{ item.name }}
                      </mat-option>
                    }
                  </mat-select>
                </mat-form-field>
              }
              @if (conversationService.conversationSettingTemplate) {
                <ng-container
                  [ngTemplateOutlet]="conversationService.conversationSettingTemplate"
                  [ngTemplateOutletContext]="{ conversation: conversation }">
                </ng-container>
              }
            </ng-template>
          </mat-tab>
          <mat-tab label="Participants" name="participants">
            <ng-template matTabContent>
              <app-participants-list
                [conversationService]="conversationService"
                [conversation]="conversation">
              </app-participants-list>
            </ng-template>
          </mat-tab>
        </mat-tab-group>
      }
    </mat-dialog-content>
    <mat-dialog-actions>
      @switch (tab) {
        @case ('settings') {
          @if (hasAdminRole) {
            <button
              mat-button
              color="primary">
              Save
            </button>
          }
          @if (!hasAdminRole) {
            <button
              mat-button
              type="button"
              color="primary"
              mat-dialog-close>
              Done
            </button>
          }
          @if (joined && showLeaveConverstation) {
            <button
              mat-button
              (click)="leave()"
              color="warn"
              type="button">
              Leave Conversation
            </button>
          }
          @if (hasAdminRole) {
            <button
              mat-button
              type="button"
              mat-dialog-close>
              Cancel
            </button>
          }
        }
        @case ('participants') {
          <button
            mat-button
            type="button"
            color="primary"
            mat-dialog-close>
            Done
          </button>
        }
      }
    </mat-dialog-actions>
  </fs-dialog>
</form>
